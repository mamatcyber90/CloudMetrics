---

# Azure

- name: Register Azure sending node public IP
  set_fact:
    iperf3-sending: "{{ hostvars['localhost'].azure_ips.0 }}"

- name: Register Azure sending node private IP
  set_fact:
    iperf3-sending-private: "{{ hostvars['localhost'].azure_pricate_ips.0 }}"

- name: Register Azure recieving node public IP
  set_fact:
    iperf3-recieving: "{{ hostvars['localhost'].azure_ips.1 }}"

- name: Register Azure recieving node private IP
  set_fact:
    iperf3-recieving-private: "{{ hostvars['localhost'].azure_private_ips.1 }}"

# Add security groups to azure resource group
- name: Add Azure Security Group
  azure_rm_securitygroup:
    resource_group: "{{hostvars['localhost'].resource_group}}"
    name: iperf3-rules
    rules:
      - name: iperf3_server
        protocol: TCP
        destination_port_r ange: 520
        access: Allow
        priority: 100
        direction: Inbound
